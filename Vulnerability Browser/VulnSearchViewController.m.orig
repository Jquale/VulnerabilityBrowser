//
//  VulnSearchViewController.m
//  Vulnerability Browser
//
//  Created by twslezak on 11/19/14.
//  Copyright (c) 2014 Quale, Slezak. All rights reserved.
//

#import "VulnSearchViewController.h"
<<<<<<< HEAD
#import <Parse/Parse.h>
#import "VulnerabilityObject.h"
=======
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001

@interface VulnSearchViewController ()
@property (weak, nonatomic) IBOutlet UITextField *searchTextField;

@property NSMutableArray* vulnerabilities;
@property NSString *theQuery;
<<<<<<< HEAD
@property NSMutableArray* yearArray;
@property NSArray* searchArray;

=======
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001

@end

@implementation VulnSearchViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
<<<<<<< HEAD
    
    //saving years
    self.yearArray = [[NSMutableArray alloc] init];
    for (int i = 0; i <= 11; i++)
    {
        NSNumber* year = [NSNumber numberWithInt:2003 + i ];
        [self.yearArray addObject:year];
    }
    
    self.vulnerabilities = [[NSMutableArray alloc] init];
    self.searchArray = [[NSArray alloc] init];
    
    [self getAllVulnerabilities];
    
=======
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
    
<<<<<<< HEAD

    
=======
    [self getAllVulnerabilities];
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/
//getting all of our vulnerabilities from parse
-(void)getAllVulnerabilities
{
<<<<<<< HEAD
    for (int i = 1; i<=11; i++) {
        //creating table name
        NSString *tableName = [[NSString alloc] initWithFormat: @"nvd%@", self.yearArray[i]];
        PFQuery *query = [PFQuery queryWithClassName:tableName];
        
        query.limit = 1000;
        
        [query findObjectsInBackgroundWithBlock:^(NSArray *objects, NSError *error) {
            if (!error) {
                // The find succeeded.
                //NSLog(@"Successfully retrieved %d queries.", objects.count);
                // Do something with the found objects
                for (PFObject *object in objects) {
                    //NSLog(@"%@", object.objectId);
                    
                    //creating the object
                    NSString *parseVulnName = object[@"name"];
                    NSString *parseVulnDate = object[@"date"];
                    NSString *parseVulnScore = object[@"score"];
                    NSString *parseVulnSummary = object[@"summary"];
                    
                    VulnerabilityObject *parseVulnerability = [[VulnerabilityObject alloc]initWithDataFromParse:parseVulnName
                                                                                                       vulnDate:parseVulnDate
                                                                                                      vulnScore:parseVulnScore
                                                                                                    vulnSummary:parseVulnSummary];
                    //adding the object to our array of vulnerabilities
                    [self.vulnerabilities addObject:parseVulnerability];
                    
                }
             
            }
            else
            {
                // Log details of the failure
                NSLog(@"Error: %@ %@", error, [error userInfo]);
            }
        }];

    }
   }
=======
    
}
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001

//segue to pass the query
-(void) prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender
{
    //doing the logic to update my query based on what is selected
    
<<<<<<< HEAD
    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"SELF.vulnSummary contains[c] %@",self.searchTextField.text];
    self.searchArray = [self.vulnerabilities filteredArrayUsingPredicate:predicate];
    NSLog(@"HERE %@",self.searchArray);
=======
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001
    //    PFQuery *query = [PFUser query];
    //
    //    [query whereKey:@"user" equalTo:object.user]
    
    VulnerabilitySearchListViewController *dest = segue.destinationViewController;
<<<<<<< HEAD
    dest.vulnerabilityResults = self.searchArray;
=======
    //dest.vulnerabilityResults = self.vulnerabilitiesSearch;
>>>>>>> a1e4c6d9a149564f76500ec0a7933a26fb640001
    
}
@end
